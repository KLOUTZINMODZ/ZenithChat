# üîÑ Como Reiniciar o Servidor Chat API

## üö® IMPORTANTE
As altera√ß√µes em `src/routes/proposalRoutes.js` **N√ÉO** ter√£o efeito at√© que o servidor seja reiniciado!

---

## üìã M√©todos de Restart

### **M√©todo 1: Via SSH (Recomendado)**

```bash
# 1. Conecte ao servidor
ssh usuario@zenith.enrelyugi.com.br

# 2. V√° para o diret√≥rio do projeto
cd /caminho/para/ZenithChat

# 3. Reinicie com PM2
pm2 restart ZenithChat

# 4. Verifique os logs
pm2 logs ZenithChat --lines 50
```

---

### **M√©todo 2: Se n√£o usar PM2**

```bash
# 1. Encontre o processo
ps aux | grep node

# 2. Mate o processo (substitua PID pelo ID do processo)
kill -9 PID

# 3. Inicie novamente
npm start
# OU
node src/server.js
```

---

### **M√©todo 3: Restart autom√°tico (se usar nodemon)**

Se o servidor estiver rodando com `nodemon`, as mudan√ßas ser√£o aplicadas automaticamente.

```bash
# Verifique se est√° usando nodemon
ps aux | grep nodemon

# Se sim, apenas salve o arquivo e ele reinicia sozinho
```

---

## ‚úÖ Como Verificar Se Reiniciou

Ap√≥s reiniciar, tente aceitar a proposta novamente e **verifique os logs no servidor**.

Voc√™ dever√° ver:

```
üîç [Proposal Accept] Received request for proposal: ...
üîç [Proposal Accept] BoosterId (normalized): 6897d82c8cdd40188e08a224
üîç [Proposal Accept] ClientId (normalized): 68a27017da1e592e29195df1
üîç [Proposal Accept] ProposalId is composite format, need to find real proposal ID
üîó [Proposal Accept] Fetching proposals from: https://zenithapi-steel.vercel.app/api/boosting-requests/68ee950477bab05ae3f000d0/proposals
‚úÖ [Proposal Accept] Found 1 proposals for boosting 68ee950477bab05ae3f000d0
‚úÖ [Proposal Accept] Found matching proposal ID: {REAL_ID} for booster 6897d82c8cdd40188e08a224
üîó [Proposal Accept] Forwarding to: https://zenithapi-steel.vercel.app/api/boosting-requests/.../proposals/{REAL_ID}/accept
```

---

## üêõ Se Continuar com Erro 404

### **Poss√≠vel Causa 1: Servidor n√£o reiniciou**
- Certifique-se de que o processo foi realmente reiniciado
- Verifique o timestamp dos logs (deve ser recente)

### **Poss√≠vel Causa 2: C√≥digo n√£o foi enviado ao servidor**
```bash
# No servidor
cd /caminho/para/ZenithChat
git pull origin main
npm install  # Se houver novas depend√™ncias
pm2 restart ZenithChat
```

### **Poss√≠vel Causa 3: Rota n√£o existe na API principal**
A rota que o Chat API est√° tentando chamar √©:
```
GET /api/boosting-requests/{boostingId}/proposals
```

Se a API principal n√£o tiver essa rota, precisaremos implement√°-la.

---

## üîç Debug Avan√ßado

### **Ver todos os processos PM2:**
```bash
pm2 list
```

### **Ver logs em tempo real:**
```bash
pm2 logs ZenithChat
```

### **Ver informa√ß√µes do processo:**
```bash
pm2 info ZenithChat
```

### **Restart for√ßado:**
```bash
pm2 delete ZenithChat
pm2 start ecosystem.config.js
# OU
pm2 start src/server.js --name ZenithChat
```

---

## üìù Checklist de Troubleshooting

- [ ] Arquivo `proposalRoutes.js` foi salvo
- [ ] C√≥digo foi enviado ao servidor (git push)
- [ ] Servidor foi acessado via SSH
- [ ] Comando de restart foi executado
- [ ] Logs mostram timestamp recente
- [ ] Logs mostram nova l√≥gica sendo executada
- [ ] Frontend foi recarregado (Ctrl+R)
- [ ] Tentativa de aceitar proposta foi feita novamente

---

## üöÄ Alternativa: Deploy Autom√°tico

Se seu servidor usar **CI/CD** (GitHub Actions, etc.), voc√™ pode:

1. **Commitar as mudan√ßas:**
```bash
git add src/routes/proposalRoutes.js
git commit -m "fix: Corrige busca de proposalId real na API principal"
git push origin main
```

2. **Aguardar deploy autom√°tico** (se configurado)

3. **Testar ap√≥s deploy concluir**

---

## ‚ö†Ô∏è ATEN√á√ÉO

**O erro 404 continuar√° acontecendo at√© que o servidor seja reiniciado!**

Sem o restart, o c√≥digo antigo (que n√£o busca o ID real) continuar√° sendo executado.

---

**Status Atual:** ‚è≥ Aguardando restart do servidor  
**Pr√≥ximo Passo:** Acessar servidor via SSH e executar `pm2 restart ZenithChat`  
**Verifica√ß√£o:** Logs devem mostrar nova l√≥gica de busca de propostas

---

**Criado em:** 14/10/2025  
**Arquivos Modificados:** `src/routes/proposalRoutes.js` (linhas 47-193)
