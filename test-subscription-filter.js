/**
 * Teste espec√≠fico para verificar se h√° filtragem baseada em subscription
 */

const axios = require('axios');

const CHAT_API_URL = 'https://zenith.enrelyugi.com.br/';
const USER_ID = '6897d82c8cdd40188e08a224';

async function testSubscriptionFilter() {
  console.log('üîç Testando filtragem por subscription...');
  
  console.log('\nüìã INSTRU√á√ïES:');
  console.log('1. Refresh o frontend para aplicar nova subscription');
  console.log('2. Aguarde conex√£o WebSocket');
  console.log('3. Verifique console do navegador');
  

  console.log('\n‚è±Ô∏è Aguarde 5 segundos para refresh do frontend...');
  await new Promise(resolve => setTimeout(resolve, 5000));


  const subscriptionTypes = [
    'new_proposal',
    'proposal_accepted', 
    'new_boosting',
    'boosting_completed',
    'targeted_test'
  ];

  for (let i = 0; i < subscriptionTypes.length; i++) {
    const type = subscriptionTypes[i];
    
    console.log(`\n‚úÖ TESTE ${i + 1}: Type = ${type} (NA SUBSCRIPTION)`);
    
    try {
      await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
        userIds: [USER_ID],
        notification: {
          id: `sub_${type}_${Date.now()}`,
          title: `Teste ${type.toUpperCase()}`,
          message: `Notifica√ß√£o do tipo ${type} que DEVE aparecer`,
          type: type,
          timestamp: new Date().toISOString(),
          isRead: false
        }
      });
      console.log(`‚úÖ Enviada: ${type}`);
    } catch (error) {
      console.error(`‚ùå Erro enviando ${type}:`, error.message);
    }
    
    await new Promise(resolve => setTimeout(resolve, 2000));
  }


  console.log(`\n‚ùå TESTE EXTRA: Type = unknown_type (N√ÉO NA SUBSCRIPTION)`);
  try {
    await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
      userIds: [USER_ID],
      notification: {
        id: `unknown_${Date.now()}`,
        title: 'Teste UNKNOWN TYPE',
        message: 'Este tipo N√ÉO est√° na subscription',
        type: 'unknown_type',
        timestamp: new Date().toISOString(),
        isRead: false
      }
    });
    console.log('‚úÖ Enviada: unknown_type');
  } catch (error) {
    console.error('‚ùå Erro enviando unknown_type:', error.message);
  }

  console.log('\nüîç RESULTADO ESPERADO:');
  console.log('- Os 5 primeiros tipos DEVEM aparecer (est√£o na subscription)');
  console.log('- O √∫ltimo tipo (unknown_type) N√ÉO deve aparecer');
  console.log('- Se ainda assim apenas targeted_test aparecer, h√° outro problema');
  
  console.log('\nüìä PR√ìXIMO PASSO:');
  console.log('- Verifique quantas notifica√ß√µes apareceram no frontend');
  console.log('- Se todas apareceram: problema resolvido!');
  console.log('- Se s√≥ targeted_test: h√° filtragem adicional no backend');
  console.log('- Se nenhuma: problema na subscription');
}

testSubscriptionFilter().catch(console.error);
