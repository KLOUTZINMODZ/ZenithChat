/**
 * Debug simples para comparar notifica√ß√µes que funcionam vs n√£o funcionam
 */

const axios = require('axios');

const CHAT_API_URL = 'https://zenith.enrelyugi.com.br/';
const USER_ID = '6897d82c8cdd40188e08a224';

async function testNotifications() {
  console.log('üîç Debug simples das notifica√ß√µes...');
  
  console.log('\nüìã INSTRU√á√ïES:');
  console.log('1. Abra o frontend no navegador');
  console.log('2. Abra o console (F12)');
  console.log('3. Observe as notifica√ß√µes que aparecem');
  
  console.log('\nüöÄ Enviando notifica√ß√µes em sequ√™ncia...');


  console.log('\n‚úÖ TESTE 1: Notifica√ß√£o FUNCIONA');
  await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
    userIds: [USER_ID],
    notification: {
      id: `works_${Date.now()}`,
      title: 'FUNCIONA - Direcionada',
      message: 'Esta notifica√ß√£o aparece no frontend!',
      type: 'targeted_test',
      timestamp: new Date().toISOString(),
      isRead: false
    }
  });
  console.log('‚úÖ Enviada: "FUNCIONA - Direcionada"');
  
  await new Promise(resolve => setTimeout(resolve, 3000));


  console.log('\nüß™ TESTE 2: Mesma notifica√ß√£o, type = new_proposal');
  await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
    userIds: [USER_ID],
    notification: {
      id: `type_test_${Date.now()}`,
      title: 'TESTE TYPE - Direcionada',
      message: 'Esta notifica√ß√£o tem type new_proposal!',
      type: 'new_proposal',
      timestamp: new Date().toISOString(),
      isRead: false
    }
  });
  console.log('‚úÖ Enviada: "TESTE TYPE - Direcionada"');
  
  await new Promise(resolve => setTimeout(resolve, 3000));


  console.log('\nüìù TESTE 3: Notifica√ß√£o formato completo');
  await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
    userIds: [USER_ID],
    notification: {
      id: `full_${Date.now()}`,
      title: 'FORMATO COMPLETO - Nova Proposta',
      message: 'Proposta com todos os campos!',
      type: 'new_proposal',
      link: '/boosting/123/proposals',
      image: 'https://via.placeholder.com/40',
      timestamp: new Date().toISOString(),
      isRead: false,
      relatedId: 'test_123',
      relatedType: 'BoostingRequest'
    }
  });
  console.log('‚úÖ Enviada: "FORMATO COMPLETO - Nova Proposta"');
  
  await new Promise(resolve => setTimeout(resolve, 3000));


  const types = ['proposal_accepted', 'new_boosting', 'boosting_completed'];
  
  for (let i = 0; i < types.length; i++) {
    const type = types[i];
    console.log(`\nüéØ TESTE ${4 + i}: Type = ${type}`);
    
    await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
      userIds: [USER_ID],
      notification: {
        id: `${type}_${Date.now()}`,
        title: `TESTE ${type.toUpperCase()}`,
        message: `Notifica√ß√£o do tipo ${type}`,
        type: type,
        timestamp: new Date().toISOString(),
        isRead: false
      }
    });
    console.log(`‚úÖ Enviada: "TESTE ${type.toUpperCase()}"`);
    
    await new Promise(resolve => setTimeout(resolve, 2000));
  }

  console.log('\nüîç AN√ÅLISE:');
  console.log('Agora verifique no frontend:');
  console.log('1. Quantas notifica√ß√µes apareceram?');
  console.log('2. Quais tipos funcionaram?');
  console.log('3. H√° algum padr√£o nos que n√£o funcionam?');
  console.log('4. Verifique o console do navegador para erros');
}

testNotifications().catch(console.error);
