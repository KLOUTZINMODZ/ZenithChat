/**
 * Teste para enviar uma notifica√ß√£o real via HackLoteAPI 
 * para verificar se chega no frontend via WebSocket
 */

const axios = require('axios');

const HACK_LOTE_API_URL = 'https://zenithapi-steel.vercel.app';
const CHAT_API_URL = 'https://12zku8.instatunnel.my/';

console.log('üß™ Testando notifica√ß√£o real via HackLoteAPI...');

async function testRealNotification() {
  try {
    // 1. Primeiro vamos testar se o endpoint do ChatApi est√° funcionando
    console.log('üì° Testando endpoint ChatApi diretamente...');
    
    const testResponse = await axios.post(`${CHAT_API_URL}/api/notifications/send`, {
      userIds: ['test_user_123'],
      notification: {
        id: `test_${Date.now()}`,
        title: 'Teste Direto ChatApi',
        message: 'Esta notifica√ß√£o foi enviada diretamente para o ChatApi',
        type: 'test',
        priority: 'high',
        timestamp: new Date().toISOString()
      },
      options: {
        persistent: true,
        retryOnFailure: true
      }
    });

    console.log('‚úÖ Resposta ChatApi:', testResponse.data);

    // 2. Aguardar um pouco
    await new Promise(resolve => setTimeout(resolve, 2000));

    // 3. Agora vamos simular uma notifica√ß√£o vinda do HackLoteAPI
    console.log('\nüì® Simulando notifica√ß√£o via HackLoteAPI...');
    
    // Simular o que o HackLoteAPI faria
    const hackLoteNotification = {
      userIds: 'test_user_123',
      notification: {
        id: `hacklote_${Date.now()}`,
        title: 'Nova Proposta Recebida!',
        message: 'Jo√£o enviou uma proposta de R$ 150,00 para seu boosting de League of Legends',
        type: 'new_proposal',
        link: '/boosting/123/proposals',
        image: 'https://via.placeholder.com/40',
        timestamp: new Date().toISOString(),
        isRead: false
      },
      options: {
        persistent: true
      }
    };

    const hackLoteResponse = await axios.post(`${CHAT_API_URL}/api/notifications/send`, hackLoteNotification);
    
    console.log('‚úÖ Notifica√ß√£o HackLote enviada:', hackLoteResponse.data);

    console.log('\nüîç Verifique o frontend para ver se as notifica√ß√µes apareceram!');
    console.log('üì± Devem aparecer 2 notifica√ß√µes:');
    console.log('   1. "Teste Direto ChatApi"');
    console.log('   2. "Nova Proposta Recebida!"');

  } catch (error) {
    console.error('‚ùå Erro no teste:', error.response?.data || error.message);
  }
}

testRealNotification();
