# üìß Configura√ß√£o do Sistema de Recupera√ß√£o de Senha

Este guia explica como configurar o sistema de recupera√ß√£o de senha usando Gmail.

## üîß Configura√ß√£o do Gmail

### 1. Criar uma Senha de App do Gmail

1. Acesse sua conta Google: [https://myaccount.google.com](https://myaccount.google.com)
2. V√° em **Seguran√ßa** ‚Üí **Verifica√ß√£o em duas etapas** (ative se ainda n√£o estiver)
3. Role at√© **Senhas de app**: [https://myaccount.google.com/apppasswords](https://myaccount.google.com/apppasswords)
4. Selecione:
   - **App:** Email
   - **Dispositivo:** Outro (nome personalizado) ‚Üí "HackLote API"
5. Clique em **Gerar**
6. **Copie a senha gerada** (16 caracteres sem espa√ßos)

### 2. Configurar Vari√°veis de Ambiente

No arquivo `.env` do **HackloteChatApi**, adicione:

```bash
EMAIL_USER=seu-email@gmail.com
EMAIL_PASSWORD=sua_senha_de_app_16_digitos
```

**Exemplo:**
```bash
EMAIL_USER=contato@hacklote.com
EMAIL_PASSWORD=abcd efgh ijkl mnop
```

## üì¶ Instala√ß√£o de Depend√™ncias

```bash
cd HackloteChatApi
npm install nodemailer
```

## üîê Recursos de Seguran√ßa Implementados

### 1. Valida√ß√£o de Provedores Confi√°veis
Apenas emails dos seguintes provedores s√£o aceitos:
- Gmail / Google Mail
- Outlook / Hotmail / Live
- Yahoo
- iCloud / Me
- ProtonMail
- AOL
- Zoho
- Mail.com

### 2. Rate Limiting
- **M√°ximo:** 3 solicita√ß√µes por hora por IP
- **Objetivo:** Prevenir ataques de for√ßa bruta

### 3. Expira√ß√£o de C√≥digo
- **Validade:** 15 minutos
- C√≥digos expirados s√£o automaticamente deletados do banco

### 4. Limita√ß√£o de Tentativas
- **M√°ximo:** 5 tentativas por c√≥digo
- C√≥digo √© invalidado ap√≥s 5 tentativas incorretas

### 5. C√≥digo de 8 D√≠gitos
- C√≥digo num√©rico aleat√≥rio
- 100.000.000 combina√ß√µes poss√≠veis
- Dificuldade extrema de adivinha√ß√£o

### 6. Prote√ß√£o Contra Enumera√ß√£o
- API sempre retorna "sucesso" mesmo se email n√£o existir
- Previne descoberta de emails cadastrados

### 7. Invalida√ß√£o Autom√°tica
- C√≥digos anteriores s√£o invalidados ao solicitar novo
- Apenas 1 c√≥digo ativo por usu√°rio

## üöÄ Testando o Sistema

### 1. Solicitar C√≥digo

```bash
POST http://localhost:3003/api/auth/forgot-password
Content-Type: application/json

{
  "email": "seu-email@gmail.com"
}
```

**Resposta:**
```json
{
  "success": true,
  "message": "C√≥digo de recupera√ß√£o enviado para seu email!",
  "data": {
    "expiresIn": 900
  }
}
```

### 2. Verificar C√≥digo

```bash
POST http://localhost:3003/api/auth/verify-reset-code
Content-Type: application/json

{
  "email": "seu-email@gmail.com",
  "code": "12345678"
}
```

**Resposta:**
```json
{
  "success": true,
  "message": "C√≥digo verificado com sucesso!",
  "data": {
    "resetToken": "60a1b2c3d4e5f6g7h8i9j0k1"
  }
}
```

### 3. Redefinir Senha

```bash
POST http://localhost:3003/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "60a1b2c3d4e5f6g7h8i9j0k1",
  "newPassword": "novaSenhaSegura123"
}
```

**Resposta:**
```json
{
  "success": true,
  "message": "Senha redefinida com sucesso! Voc√™ j√° pode fazer login."
}
```

## üé® Frontend

A p√°gina de recupera√ß√£o est√° dispon√≠vel em:
```
http://localhost:5173/forgot-password
```

### Fluxo do Usu√°rio:

1. **Passo 1:** Digita o email
2. **Passo 2:** Recebe c√≥digo por email e digita na p√°gina
3. **Passo 3:** Cria nova senha
4. **Conclus√£o:** Redirecionado para login

## üìä Modelo de Dados

**Cole√ß√£o:** `PasswordReset`

```javascript
{
  userId: ObjectId,
  email: String,
  code: String (8 d√≠gitos),
  expiresAt: Date,
  used: Boolean,
  attempts: Number,
  ipAddress: String,
  userAgent: String,
  createdAt: Date
}
```

## ‚ö†Ô∏è Troubleshooting

### Erro: "Error sending email"

**Solu√ß√£o:**
1. Verifique se a senha de app est√° correta
2. Confirme que a verifica√ß√£o em 2 etapas est√° ativada
3. Tente gerar uma nova senha de app
4. Verifique se o EMAIL_USER e EMAIL_PASSWORD est√£o no `.env`

### Erro: "Email inv√°lido"

**Solu√ß√£o:**
- Use um email de provedor confi√°vel (Gmail, Outlook, Yahoo, etc.)
- Verifique se o formato do email est√° correto

### C√≥digo n√£o chega

**Solu√ß√£o:**
1. Verifique a caixa de spam
2. Aguarde at√© 2 minutos
3. Verifique os logs do servidor: `tail -f logs/combined.log`

## üîí Boas Pr√°ticas de Produ√ß√£o

1. **Use HTTPS** em produ√ß√£o
2. **Configure CORS** adequadamente
3. **Monitore logs** para detectar abusos
4. **Use Redis** para rate limiting escal√°vel
5. **Implemente CAPTCHA** ap√≥s m√∫ltiplas tentativas
6. **Configure alertas** para atividades suspeitas
7. **Backup regular** da collection PasswordReset

## üìö Refer√™ncias

- [Nodemailer Documentation](https://nodemailer.com/)
- [Gmail App Passwords](https://support.google.com/accounts/answer/185833)
- [OWASP Password Reset](https://cheatsheetseries.owasp.org/cheatsheets/Forgot_Password_Cheat_Sheet.html)
